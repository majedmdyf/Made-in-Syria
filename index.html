<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Made in Syria — قائمة المنتجات</title>
<style>
  :root{
    --bg:#f6f7f9; --card:#fff; --text:#1f2a37; --muted:#6b7280;
    --primary:#1e88e5; --primary-weak:#e8f2fe; --border:#e5e7eb;
    --chip-bg:#f3f5f7; --chip-text:#0f172a;
    --chip-active-bg:rgba(30,136,229,.12); --chip-active-text:#1e88e5;
    --shadow:0 2px 10px rgba(0,0,0,.06); --soft:#fafafa;
    --ok:#16a34a; --danger:#ef4444;
  }
  [data-theme="dark"]{
    --bg:#0b1220; --card:#0f172a; --text:#e5e7eb; --muted:#a3a7ad;
    --primary:#60a5fa; --primary-weak:#0c1c32; --border:#213042;
    --chip-bg:#111b2a; --chip-text:#e5e7eb;
    --chip-active-bg:rgba(96,165,250,.18); --chip-active-text:#bfe0ff;
    --shadow:0 2px 12px rgba(0,0,0,.35); --soft:#0c1322;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Noto Sans Arabic","Tahoma",sans-serif;
    background:linear-gradient(180deg,var(--soft),transparent 30%), var(--bg);
    color:var(--text);
  }
  .container{max-width:1200px;margin:24px auto;padding:0 16px}

  /* Header */
  .header{
    display:grid; grid-template-columns: 1fr minmax(220px,420px) auto; gap:12px; align-items:center; margin-bottom:16px;
  }
  .brand{display:flex; align-items:center; gap:10px; font-weight:800}
  .brand-badge{width:38px;height:38px;border-radius:10px;background:conic-gradient(from 210deg,#1e88e5,#22c55e,#1e88e5); box-shadow:var(--shadow)}
  .muted{color:var(--muted);font-size:12px;margin-top:2px}
  .search{position:relative}
  .search input{width:100%; background:var(--card); color:var(--text); border:1px solid var(--border); border-radius:12px; padding:10px 38px 10px 12px}
  .search .icon{position:absolute; right:10px; top:50%; transform:translateY(-50%); color:var(--muted)}
  .toggle{background:var(--card); border:1px solid var(--border); padding:8px 12px; border-radius:12px; cursor:pointer}

  /* Tabs (no underline) */
  .tabs{display:flex; background:var(--card); border:1px solid var(--border); border-radius:12px; overflow:hidden; box-shadow:var(--shadow); margin-bottom:10px}
  .tab{flex:1; padding:12px 8px; text-align:center; cursor:pointer; user-select:none; color:var(--text); background:transparent; border:none; font-weight:700}
  .tab[aria-selected="true"]{ background:var(--chip-active-bg); color:var(--chip-active-text) }

  /* Categories */
  .categories{display:flex;gap:8px;overflow-x:auto;padding:4px 2px 10px}
  .chip{ padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:var(--chip-bg); color:var(--chip-text); font-size:14px; cursor:pointer; white-space:nowrap }
  .chip.active{ background:var(--chip-active-bg); color:var(--chip-active-text); border-color:transparent }

  /* Grid + Card */
  .grid{display:grid; gap:16px; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));}
  .card{ background:var(--card); border:1px solid var(--border); border-radius:14px; overflow:hidden; box-shadow:var(--shadow); display:flex; flex-direction:column }
  .thumb{ height:140px; background:linear-gradient(135deg, var(--c1,#b22222), var(--c2,#1f7a4c)); position:relative }
  .badge{ position:absolute; top:10px; inset-inline-start:10px; background:rgba(0,0,0,.55); color:#fff; padding:6px 10px; border-radius:999px; font-size:12px; backdrop-filter:blur(3px) }
  .body{ padding:12px 14px; display:grid; gap:8px }
  .title{ font-weight:800; font-size:15px }
  .meta{ color:var(--muted); font-size:12px; display:flex; gap:10px; flex-wrap:wrap }
  .price{ font-weight:800 }
  .tags{ display:flex; gap:6px; flex-wrap:wrap }
  .tag{ font-size:11px; padding:4px 8px; border-radius:999px; background:var(--primary-weak); color:var(--primary) }
  .cta{ display:flex; gap:8px; align-items:center }
  .qty{ width:70px; background:var(--card); color:var(--text); border:1px solid var(--border); border-radius:8px; padding:6px 8px }
  .btn{ flex:1; background:var(--primary); color:#fff; border:none; padding:10px 12px; border-radius:10px; cursor:pointer }
  .btn:hover{ filter:brightness(1.05) }
  .empty{ grid-column:1/-1; text-align:center; color:var(--muted); border:1px dashed var(--border); border-radius:12px; padding:28px }

  @media (max-width:560px){
    .header{ grid-template-columns: 1fr auto; }
    .search{ grid-column:1/-1; order:3 }
  }
</style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="brand" aria-label="الشعار">
        <div class="brand-badge" aria-hidden="true"></div>
        <div>
          <div>Made in Syria</div>
          <div class="muted">دعم المنتج المحلي واستيراد مسؤول</div>
        </div>
      </div>

      <label class="search" aria-label="بحث">
        <span class="icon" aria-hidden="true">🔎</span>
        <input id="search" type="search" placeholder="ابحث باسم المنتج أو الكود أو التصنيف..." autocomplete="off" />
      </label>

      <button id="themeToggle" class="toggle" type="button" aria-label="تبديل الوضع">نهاري</button>
    </div>

    <!-- Tabs -->
    <div class="tabs" role="tablist" aria-label="الأقسام">
      <button class="tab" id="tab-syrian" role="tab" aria-controls="panel" aria-selected="true" data-section="syrian">منتجات سورية</button>
      <button class="tab" id="tab-global" role="tab" aria-controls="panel" aria-selected="false" data-section="global">منتجات عالمية</button>
    </div>

    <!-- Categories -->
    <div id="categories" class="categories" aria-label="التصنيفات"></div>

    <!-- Products -->
    <section id="panel" class="section" role="tabpanel" aria-labelledby="tab-syrian">
      <div id="grid" class="grid"></div>
    </section>
  </div>

<script>
  // إعداد رقم واتساب المستلم (غيّره لرقمك، بدون +)
  const WHATSAPP_NUMBER = "963936870900"; // مثال: 963944123456

  // مصادر البيانات (manifest)
  const SOURCES = {
    syrian: { base: "products/syrian/", manifests: ["manifest.php","manifest.json"] },
    global: { base: "products/global/", manifests: ["manifest.php","manifest.json"] }
  };

  // الحالة
  const state = { section: localStorage.getItem("section") || "syrian", category: "الكل", query: "" };
  const body = document.body;
  const themeToggle = document.getElementById("themeToggle");
  const tabs = document.querySelectorAll(".tab");
  const catsEl = document.getElementById("categories");
  const grid = document.getElementById("grid");
  const searchInput = document.getElementById("search");

  // Theme
  const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
  setTheme(localStorage.getItem("theme") || (prefersDark ? "dark" : "light"));
  themeToggle.addEventListener("click", () => {
    const next = body.getAttribute("data-theme") === "dark" ? "light" : "dark";
    setTheme(next); localStorage.setItem("theme", next);
  });
  function setTheme(mode){ body.setAttribute("data-theme", mode); themeToggle.textContent = mode === "dark" ? "ليلي" : "نهاري"; }

  // تبويبات
  tabs.forEach(btn=>{
    btn.setAttribute("aria-selected", String(btn.dataset.section === state.section));
    btn.addEventListener("click", async ()=>{
      if (state.section === btn.dataset.section) return;
      state.section = btn.dataset.section; state.category = "الكل"; localStorage.setItem("section", state.section);
      tabs.forEach(t => t.setAttribute("aria-selected", String(t === btn)));
      document.getElementById("panel").setAttribute("aria-labelledby", btn.id);
      await reload(); // غيّر المصدر والمنتجات
    });
  });

  // تحميل القائمة + المنتجات
  async function reload(){
    const manifest = await loadManifest(state.section);
    const files = manifest.files || [];
    const items = [];
    for (const file of files){
      try{
        const meta = await loadProductMeta(SOURCES[state.section].base + file);
        if (meta && meta.name) items.push({ ...meta, __file: file });
      }catch(e){ console.warn("تعذّر تحميل منتج:", file, e); }
    }
    window.__PRODUCTS = items;
    renderCategories();
    renderProducts();
  }

  // جلب manifest (يحاول PHP ثم JSON)
  async function loadManifest(section){
    const { base, manifests } = SOURCES[section];
    for (const m of manifests){
      try{
        const res = await fetch(base + m, { cache: "no-store" });
        if (res.ok) return await res.json();
      }catch(_){}
    }
    return { files: [] };
  }

  // قراءة ميتاداتا المنتج من داخل ملف HTML (<script id="product" type="application/json">)
  async function loadProductMeta(url){
    const html = await (await fetch(url, { cache: "no-store" })).text();
    const doc = new DOMParser().parseFromString(html, "text/html");
    const node = doc.querySelector('script#product[type="application/json"]');
    if (!node) return null;
    const data = JSON.parse(node.textContent.trim());
    // قيَم افتراضية لطيفة
    data.colors = data.colors || ["#b22222","#1f7a4c"];
    data.whatsapp = data.whatsapp || WHATSAPP_NUMBER;
    data.url = url;
    return data;
  }

  // تصنيفات ديناميكية
  function renderCategories(){
    catsEl.innerHTML = "";
    const items = window.__PRODUCTS || [];
    const set = new Set(["الكل"]);
    for (const p of items) if (p.category) set.add(p.category);
    for (const name of set){
      const b = document.createElement("button");
      b.type = "button"; b.className = "chip" + (name === state.category ? " active" : ""); b.textContent = name;
      b.addEventListener("click", ()=>{ state.category = name; catsEl.querySelectorAll(".chip").forEach(x=>x.classList.remove("active")); b.classList.add("active"); renderProducts(); });
      catsEl.appendChild(b);
    }
  }

  // البحث
  const debounced = debounce(v => { state.query = v.trim(); renderProducts(); }, 180);
  searchInput.addEventListener("input", e => debounced(e.target.value));

  // رسم المنتجات
  function renderProducts(){
    const items = (window.__PRODUCTS || []).filter(p=>{
      const catOK = state.category === "الكل" || p.category === state.category;
      const q = normalize(state.query);
      const hay = `${p.name} ${p.sku||""} ${p.category||""} ${p.origin||""} ${p.price||""}`;
      const txtOK = !q || normalize(hay).includes(q);
      return catOK && txtOK;
    });

    if (items.length === 0){
      grid.innerHTML = `<div class="empty">لا توجد نتائج مطابقة للبحث/التصنيف.</div>`;
      return;
    }

    grid.innerHTML = items.map(cardHTML).join("");
    // ربط أزرار واتساب
    grid.querySelectorAll("[data-whatsapp]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const sku = btn.dataset.sku, name = btn.dataset.name, price = parseFloat(btn.dataset.price||"0"), cur = btn.dataset.currency||"", url = btn.dataset.url, num = btn.dataset.whatsapp;
        const qtyInput = btn.closest(".card").querySelector(".qty");
        const qty = Math.max(1, parseInt(qtyInput.value || "1", 10));
        const total = (price>0) ? (price*qty) : 0;
        const lines = [
          "طلب شراء عبر تطبيق Made in Syria:",
          `المنتج: ${name}`,
          sku ? `الكود: ${sku}` : "",
          `الكمية: ${qty}`,
          price>0 ? `السعر: ${price} ${cur}` : "",
          price>0 ? `الإجمالي: ${total} ${cur}` : "",
          url ? `رابط المنتج: ${url}` : ""
        ].filter(Boolean).join("\n");
        const link = `https://wa.me/963936870900/${encodeURIComponent(num)}?text=${encodeURIComponent(lines)}`;
        window.open(link, "_blank");
      });
    });
  }

  // شكل البطاقة
  function cardHTML(p){
    const [c1,c2] = p.colors || ["#b22222","#1f7a4c"];
    const badge = state.section === "syrian" ? "صناعة سورية" : "اختيار عالمي";
    const priceStr = (p.price>0 && p.currency) ? `${p.price} ${p.currency}` : (p.price>0 ? `${p.price}` : "السعر عند الطلب");
    return `
      <article class="card">
        <a class="thumb" style="--c1:${c1};--c2:${c2}"  target="_blank" rel="noopener">
          <span class="badge">${badge}</span>
        </a>
        <div class="body">
          <div class="title">${escapeHtml(p.name)}</div>
          <div class="meta">
            ${p.category ? `<span>الفئة: ${escapeHtml(p.category)}</span>` : ""}
            ${p.origin ? `<span>المنشأ: ${escapeHtml(p.origin)}</span>` : ""}
            ${p.sku ? `<span>الكود: ${escapeHtml(p.sku)}</span>` : ""}
          </div>
          <div class="price">${escapeHtml(priceStr)}</div>
          <div class="tags">
            ${(p.tags||[]).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("")}
          </div>
          <div class="cta">
            <input type="number" class="qty" min="1" value="1" aria-label="الكمية">
            <button class="btn"
              data-whatsapp
              data-name="${escapeHtml(p.name)}"
              data-sku="${escapeHtml(p.sku||"")}"
              data-price="${p.price||0}"
              data-currency="${escapeHtml(p.currency||"")}"
              data-url="${escapeHtml(p.url||"")}"
              data-whatsapp="${escapeHtml(p.whatsapp||WHATSAPP_NUMBER)}"
            >طلب عبر واتساب</button>
          </div>
        </div>
      </article>
    `;
  }

  // أدوات
  function debounce(fn, wait){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), wait); }; }
  function normalize(s){ return (s||"").toString().trim().toLowerCase().replace(/[ًٌٍَُِّْـ]/g,"").replace(/[٠-٩]/g, d=>"٠١٢٣٤٥٦٧٨٩".indexOf(d)); }
  function escapeHtml(s){ return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"); }

  // تشغيل أولي
  (async function init(){
    // اضبط التبويب النشط
    tabs.forEach(t => t.setAttribute("aria-selected", String(t.dataset.section === state.section)));
    document.getElementById("panel").setAttribute("aria-labelledby", `tab-${state.section}`);
    await reload();
  })();
</script>
</body>
</html>